- [TKS Exercise Tracker](#tks-exercise-tracker)
  - [`./tsconfig.json`](#tsconfigjson)
  - [`./tsconfig.base.json`](#tsconfigbasejson)
  - [`./package.json`](#packagejson)
  - [`./config/aliasPaths.js`](#configaliaspathsjs)
  - [`./config-overrides.js`](#config-overridesjs)
  - [`./.env.local`](#envlocal)

# TKS Exercise Tracker

Initialized with:

```bash
yarn create react-app tks-exercise-tracker-client --template typescript
```

## `./tsconfig.json`

```json
{
  "allowSyntheticDefaultImports": true,
  "compilerOptions": {
    "target": "es5",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "strictPropertyInitialization": false,
    "experimentalDecorators": true,
    "forceConsistentCasingInFileNames": true,
    "noFallthroughCasesInSwitch": true,
    "module": "esnext",
    "moduleResolution": "node",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "extends": "./tsconfig.base.json",
  "include": ["src"]
}
```

- Most of the options here are default, generated by `create-react-app`, except for `"extends": "./tsconfig.base.json"`.
- This option is to enable IntelliSense for importing modules and TypeScript (probably).
  <!-- TODO: Maybe try and make that script TypeScript also? -->
  - The changes to webpack's `alias` is handled by `react-app-rewired` via a `./config/aliasPaths.js` script.
    - Maybe try to convert that script to TypeScript also?

## `./tsconfig.base.json`

<!-- TODO: Maybe add ["./components/*"] -->
<!-- Not sure if that's the right syntax, will need to check later. -->

```json
{
  "compilerOptions": {
    "baseUrl": "./src",
    "paths": {
      "@components": ["./components"],
      "@hooks": ["./hooks"],
      "@store": ["./store"],
      "@theme": ["./theme"],
      "@utility": ["./utility"]
    }
  }
}
```

## `./package.json`

```json
  "scripts": {
    "prestart": "node ./config/aliasPaths.js",
    "start": "REACT_APP_ENVIRONMENT=development react-app-rewired start",
    "build": "react-app-rewired build",
    "build:run": "yarn build && yarn serve -n -s dist",
    "test": "react-app-rewired test",
    "eject": "react-app-rewired eject"
  },
```

- `"prestart":"node ./config/aliasPaths.js"` - figures out all of the paths to alias for webpack and extend for `tsconfig.json`, creating `tsconfig.base.json`.
  - Just like there is a `pre_` option prefix, there is also a `post_` prefix. Read this for more information about [scripts in `package.json`](https://docs.npmjs.com/cli/v8/using-npm/scripts).
  <!-- TODO: Convert to TypeScript. -->
  - Will try to convert to TypeScript.
  - <!-- TODO: Rename environmental variable to REACT_APP_NODE_ENV? -->
- `"start":"REACT_APP_ENVIRONMENT=development react-app-rewired start"`
- `"build:run":"yarn build & yarn serve -n -s dist"` -
  <!-- TODO: FInish the flags. -->
  - `-s` -
  - `-n` -

## `./config/aliasPaths.js`

```js
const { lstatSync, readdir, writeFile } = require("fs");
const path = require("path");
const { promisify } = require("util");

const promiseReadDir = promisify(readdir);
const promiseWriteFile = promisify(writeFile);

const getSrcDirs = async () => {
  const dirContent = await promiseReadDir(path.resolve(__dirname, "..", "src"));

  const dirs = dirContent
    .filter((item) =>
      lstatSync(path.resolve(__dirname, "..", "src", item)).isDirectory()
    )
    .map((dir) => ({ name: `@${dir}`, path: dir }));

  await promiseWriteFile(
    path.resolve(__dirname, "PATH_ALIASES.json"),
    JSON.stringify(dirs)
  );

  return dirs;
};

const setupPathAliases = async () => {
  const PATH_ALIASES = await getSrcDirs();

  const tsconfigBase = {
    compilerOptions: {
      baseUrl: "./src",
      paths: PATH_ALIASES.reduce(
        (acc, pathAlias) => ({
          ...acc,
          [pathAlias.name]: [`./${pathAlias.path}`],
        }),
        {}
      ),
    },
  };

  await promiseWriteFile(
    path.resolve(__dirname, "..", "tsconfig-base.json"),
    JSON.stringify(tsconfigBase)
  );
};

setupPathAliases();
```

<!-- TODO: Rewrite this and ./config-overrides.js so that I won't need to have a temp file. -->

```js
const getSrcDirs = async () => {
  const dirContent = await promiseReadDir(path.resolve(__dirname, "..", "src"));
```

- Read the content of the `src` directory.

```js
const dirs = dirContent
  .filter((item) =>
    lstatSync(path.resolve(__dirname, "..", "src", item)).isDirectory()
  )
  .map((dir) => ({ name: `@${dir}`, path: dir }));
```

- Filter out everything that is not a directory.
- Create a JSON object from the result that looks like this:

  ```json
  [
    { "name": "@components", "path": "components" },
    { "name": "@hooks", "": "hooks" },
    { "name": "@store", "": "store" },
    { "name": "@theme", "": "theme" },
    { "name": "@utility", "": "utility" },
    ...
  ]
  ```

  so that it can be written to a `./PATH_ALIASES.json`, to be read by `../config-overrides.js`.

  - The basic idea is that every directory inside of `src` will be aliased.

```js
  await promiseWriteFile(
    path.resolve(__dirname, "PATH_ALIASES.json"),
    JSON.stringify(dirs)
  );

  return dirs;
};
```

- Write out the content of the created JSON to a file named `PATH_ALIAS.js` to be read by `../config-overrides.js`.

## `./config-overrides.js`

<!-- TODO: This is probably the only file that I would not be able to convert to TS, since it is read as is by `react-app-rewired`. -->

```js
const path = require("path");

const PATH_ALIASES = require("./config/PATH_ALIASES.json");
```

- Import the aliased paths from the previous operation.

```js
const config = {
  PATH_ALIASES,
  webpack: (config) => ({
```

- The `config` seems to be the thing that holds all of `webpack`'s configuration, so we're just spreading some more stuff into it.

```js
    ...config,
    resolve: {
      ...config.resolve,
      alias: PATH_ALIASES.reduce(
        (acc, pathAlias) => ({
          ...acc,
          [pathAlias.name]: path.resolve(__dirname, `src/${pathAlias.path}`),
        }),
        {}
      ),
    },
  }),
};

module.exports = config;
```

## `./.env.local`

```json
BROWSER=none
BUILD_PATH='./dist'

PORT=3000

SKIP_PREFLIGHT_CHECK=true
```
